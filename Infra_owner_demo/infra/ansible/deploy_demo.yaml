# 部署示範基礎設施（構建前端映像，啟動容器）
- name: 部署示範基礎設施（構建前端映像，啟動容器）
  hosts: localhost
  gather_facts: false
  tasks:
    # 確保前端構建依賴項存在
    - name: 確保前端構建依賴項存在
      command: npm install
      args:
        chdir: "{{ playbook_dir }}/../../frontend"
      register: npm_install

    # 構建前端靜態資源
    - name: 構建前端靜態資源
      command: npm run build
      args:
        chdir: "{{ playbook_dir }}/../../frontend"
      register: npm_build
    
    # 啟動 Docker Compose（如有必要，構建映像）
    - name: 啟動 Docker Compose（如有必要，構建映像）
      community.docker.docker_compose_v2:
        project_src: "{{ playbook_dir }}/.."  # 此行需縮排
        build: always
        state: present
      register: compose_up

    # 顯示結果
    - name: 顯示結果
      debug:
        msg: "Compose 結果: {{ compose_up }}"