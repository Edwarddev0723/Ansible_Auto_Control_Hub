```markdown
# Ansible 自動化網站部署管理系統 --- 專案說明書（含 AI 操作模組）

## 一、系統概述

本專案旨在開發一個**基於 Ansible
的自動化網站部署平台**，並提供「圖形化操作」與「智慧 AI
助理」兩種互動方式，讓使用者能更直覺、更高效地進行多台伺服器的部署與管理。

透過本系統，使用者可以： 
- 在網頁上選擇任務與主機，一鍵執行部署； 
- 或者使用內建的 AI 助理，直接以對話方式下達指令，由 AI自動生成並執行相對應的 Ansible 操作。

此系統整合 **Ansible 自動化框架** 與 **AI
智能控制技術**，提供可視化、可追蹤且可編輯的部署體驗，提升團隊在系統維運與應用部署上的效率與準確性。

------------------------------------------------------------------------

## 二、系統運作原理

1.  **Ansible 自動化控制**\
    系統的後端伺服器安裝並設定 Ansible，透過 SSH
    連線多台目標伺服器。使用者無須登入伺服器，只需透過網頁或 AI
    助理即可完成操作。

2.  **前端網頁操作介面**\
    使用者可透過表單方式選擇部署任務、目標主機與參數，系統後端會自動產生並執行對應的
    Ansible 指令。

3.  **AI 智能助理控制**\
    系統內建一個能理解自然語言的 AI 助理，已具備 Ansible
    操作知識。使用者僅需以聊天方式描述需求，AI 會自動：

    -   解析意圖；
    -   建立或修改 Ansible Playbook；
    -   執行相應的部署操作；
    -   並將結果顯示回網頁介面。

4.  **紀錄與審計機制**\
    所有由使用者或 AI
    觸發的部署動作，系統都會記錄詳細紀錄，確保操作可回溯、可管理。

------------------------------------------------------------------------

## 三、系統主要功能模組

### 1. 使用者登入與權限管理

確保系統安全與分層操作。

-   支援帳號登入與身分驗證。
-   權限角色：
    -   **管理員（Admin）**：可管理主機、Playbook、AI
        產出內容，並部署到正式環境。
    -   **開發者（Developer）**：可部署到測試環境、檢視 AI 結果。
-   所有操作皆記錄執行者身分。

------------------------------------------------------------------------

### 2. 伺服器（Inventory）管理

集中管理可被 Ansible 操作的目標主機。

-   功能：
    -   新增、編輯、刪除伺服器。
    -   建立伺服器群組（如 staging、production）。
    -   測試 SSH 連線狀態（Ansible ping）。
-   所有主機資料儲存在資料庫中，執行任務時會自動產生暫時性 Inventory
    檔案。

------------------------------------------------------------------------

### 3. 任務與 Playbook 管理

管理所有可執行的自動化任務腳本。

-   顯示現有 Playbook 清單與用途。
-   設定可輸入的變數（如版本、分支名稱）。
-   限制 Playbook 的執行權限（例如僅限管理員於正式環境執行）。
-   支援 AI 產生的 Playbook 匯入（詳見第七模組）。

備註：
- Playbook 以結構化 JSON（content_struct）儲存並由前端以表單編輯；
- 建立部署工作時必須選擇已儲存的 playbook_id。

------------------------------------------------------------------------

### 4. 部署執行（Deployment）

主要操作介面，負責執行部署任務。

-   流程：
    1.  選擇 Playbook
    2.  選擇主機或群組
    3.  填入變數與參數
    4.  執行部署
-   系統自動：
    -   生成 Ansible 執行指令；
    -   即時顯示執行 log（透過 WebSocket 串流傳送狀態與日誌）；
    -   顯示每台主機的執行結果（成功、變更、失敗）。
-   執行結果會自動儲存至紀錄模組。

補充：支援「重新執行」（Retry），並可嘗試「取消」（Cancel）執行中的部署工作（實際可取消程度視執行引擎支援而定）。

------------------------------------------------------------------------

### 5. 部署紀錄與審計（History & Audit Log）

記錄並追蹤所有操作。

-   記錄內容：
    -   任務名稱
    -   執行時間
    -   執行者（人類或 AI）
    -   目標伺服器
    -   參數設定
    -   結果狀態（成功 / 失敗）
    -   完整執行日誌
-   提供搜尋與篩選功能。
-   支援「重新執行」功能（Retry）。
-   支援嘗試「取消」執行中的工作（Cancel）。
-   日誌可供全文下載（純文字）或以 JSON 行陣列方式查閱。

------------------------------------------------------------------------

### 6. 系統設定與安全管理

確保部署過程安全可靠。

-   SSH 金鑰管理與 fingerprint 顯示。
-   敏感資料加密（API key、Token、密碼等）。
-   權限設定與動作審查。
-   控制後端執行權限，防止 root 操作風險。

------------------------------------------------------------------------

### 7. AI 智能助理操作模組

> 讓使用者以自然語言與 AI 對話，即可完成部署或設定。

#### 功能目標：

提供一個內建 AI 助理，理解使用者的意圖並自動操作 Ansible。\
這讓不熟悉技術指令的使用者，也能用簡單語句進行部署與設定。

#### 操作流程：

1.  使用者在「AI 助理」頁面輸入指令，例如：
    「幫我把網站更新到最新版本」
    「在 production 加一台新的 web server」
    「重新啟動資料庫服務」
2.  AI 分析語句內容，理解任務需求。
3.  AI 自動：
    -   產生對應的 Ansible Playbook 或任務設定；
    -   顯示在畫面上供使用者確認；
    -   經使用者同意後執行部署。
4.  系統會自動將 AI 生成的內容儲存，並顯示在：
    -   Playbook 清單中（可人工修改或刪除）
    -   部署紀錄中（標示為「AI 產生任務」）

#### 特點與安全機制：

-   AI 所生成的內容，使用者可手動修改或覆寫。
-   所有 AI 操作皆有紀錄（包括原始語句與轉換後的指令）。
-   管理員可限制 AI 執行的範圍（如禁止直接操作正式環境）。
-   提供 AI 操作審查頁面，可檢視 AI 所建立的 Playbook 或設定。

------------------------------------------------------------------------

## 四、系統架構設計

### 前端（Frontend）

-   使用 Vue.js 或 React 實作。
-   提供兩種操作模式：
    -   傳統部署頁面（表單模式）
    -   AI 助理頁面（對話模式）
-   顯示執行結果、AI 建立內容與歷史紀錄。

### 後端（Backend）

-   使用 Python（Flask / FastAPI / Django）。
-   整合：
    -   Ansible 控制模組；
    -   AI 模組（可透過 API 呼叫外部 AI 模型服務）；
    -   使用者與權限管理；
    -   部署紀錄儲存；
    -   WebSocket 即時日誌串流。
-   提供 RESTful API 給前端介面呼叫。

備註：API 採用統一回應包裝（{ ok: true, data } / { ok: false, error }）與標準錯誤碼，詳細請參見 API 設計檔。

### 資料庫（Database）

主要資料表：

| 資料表名稱 | 功能說明 |
|-------------|-----------|
| `users` | 使用者登入資料與角色 |
| `hosts` | 伺服器清單與群組 |
| `playbooks` | 任務腳本與對應檔案 |
| `deploy_jobs` | 每次部署紀錄 |
| `ssh_keys` | SSH 金鑰管理（名稱、指紋、公鑰、建立者、建立時間）|
| `ai_tasks` | AI 生成的任務、語句與執行結果 |
| `logs` | 詳細執行紀錄與輸出內容 |


------------------------------------------------------------------------

## 五、系統運作流程示意

    使用者登入 → 選擇操作方式（圖形介面 / AI 助理） 
       ↓
    [圖形介面]：選取任務 → 選擇主機 → 執行部署
    [AI 助理]：輸入語句 → AI 解析 → 生成任務 → 使用者確認 → 執行部署
       ↓
    Ansible 自動化執行 → 顯示結果 → 記錄與審計

------------------------------------------------------------------------

## 六、預期效益

-   **自動化**：一鍵部署多台伺服器，大幅減少人工操作時間。
-   **智慧化**：使用者可直接用自然語言下達命令，AI會自動完成設定與部署。
-   **透明可控**：AI 所建立的內容可人工審查與修改，確保安全。
-   **高可追蹤性**：所有人類與 AI 操作皆被詳細記錄。
-   **降低門檻**：即使不懂 Ansible 語法，也能透過 AI 助理完成任務。

------------------------------------------------------------------------

## 七、未來擴充方向

-   整合 ChatGPT / 自訓模型 API，提高語意理解準確度。
-   新增語音操作功能（語音指令部署）。
-   整合 CI/CD 工具（如 GitLab CI、Jenkins）。
-   AI 自動建議最佳部署策略（例如選擇最合適的伺服器組）。
-   支援 Rollback 功能與自動錯誤修復。

------------------------------------------------------------------------

## 八、結語

本系統結合了自動化與人工智慧兩大核心技術，讓網站部署從「人工操作」進化為「智慧協作」。
使用者可選擇以傳統操作介面完成任務，或以對話方式讓 AI
協助生成並執行部署。
此平台將成為團隊維運流程中，**最直覺、最安全、也最具擴充性的部署管理解決方案**。
```